---
// src/components/Header.astro
import Search from './Search.tsx';
import { Image } from 'astro:assets';
import logoSrc from '../assets/logo.svg';
---
<header id="main-header" class="bg-white/80 dark:bg-dark-card/80 backdrop-blur-sm sticky top-0 z-40 border-b border-[var(--color-border)] dark:border-[var(--color-dark-border)]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        {/* --- TATA LETAK DESKTOP (md+) --- */}
        <div class="hidden md:flex items-center justify-between h-16">
            <div class="flex items-center gap-6">
                 <a href="/" class="flex items-center" aria-label="Crevalen">
                    <Image 
                        src={logoSrc} 
                        alt="Logo Crevalen" 
                        class="h-8 w-auto" 
                        width={150}
                        height={32}
                    />
                </a>

                <Search client:visible />
            </div>
            <div class="flex items-center gap-4">
                <nav class="flex items-center gap-6 font-sans text-sm font-medium">
                    <a href="/katgori/tips" class="text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:text-[var(--color-primary)] dark:hover:text-[var(--color-dark-primary)] transition-colors">Tips</a>
                    <a href="/categories/investasi" class="text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:text-[var(--color-primary)] dark:hover:text-[var(--color-dark-primary)] transition-colors">Investasi</a>
                    <a href="/categories/saham" class="text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:text-[var(--color-primary)] dark:hover:text-[var(--color-dark-primary)] transition-colors">Saham</a>
                    <a href="/categories/trading" class="text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:text-[var(--color-primary)] dark:hover:text-[var(--color-dark-primary)] transition-colors">Trading</a>
                    <a href="/categories/story" class="text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:text-[var(--color-primary)] dark:hover:text-[var(--color-dark-primary)] transition-colors">Story</a>
                </nav>
                <button id="theme-toggle-desktop" title="Ganti tema" class="relative inline-flex items-center h-7 w-12 rounded-full transition-colors bg-[var(--color-border)] dark:bg-[var(--color-dark-border)]">
                    <span class="inline-block h-5 w-5 transform rounded-full bg-[var(--color-background)] dark:bg-[var(--color-dark-secondary)] transition-transform dark:translate-x-6"></span>
                </button>
            </div>
        </div>
    
        {/* --- TATA LETAK MOBILE (<md) --- */}
        <div class="flex md:hidden items-center justify-between h-16">
            <a href="/" class="flex items-center" aria-label="Crevalen">
                <Image 
                    src={logoSrc} 
                    alt="Logo Crevalen" 
                    class="h-8 w-auto"
                    width={150}
                    height={32}
                />
            </a>
            <div class="flex items-center gap-2">
               <Search client:visible />
                <button id="menu-toggle" title="Buka menu" class="p-2 rounded-md text-[var(--color-text)] dark:text-[var(--color-dark-text)] hover:bg-[var(--color-border)] dark:hover:bg-[var(--color-dark-border)]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>

    </div>
    
    {/* ======================================================= */}
    {/* ===== DROPDOWN MENU MOBILE DENGAN GAYA & TRANSISI BARU ==== */}
    {/* ======================================================= */}
    <div 
        id="mobile-menu" 
        class="absolute md:hidden top-full inset-x-0 p-4 border-b border-[var(--color-border)] dark:border-[var(--color-dark-border)] bg-[var(--color-background)] dark:bg-[var(--color-dark-card)]
               transition-all duration-300 ease-in-out
               opacity-0 -translate-y-4 pointer-events-none"
    >
        <nav class="flex flex-col gap-2 font-sans font-medium">
            <a href="/" class="flex items-center gap-4 p-3 font-semibold text-[var(--color-text)] dark:text-[var(--color-dark-text)] rounded-lg hover:bg-[var(--color-border)] dark:hover:bg-[var(--color-dark-border)] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span>Beranda</span>
            </a>
            <a href="/categories/teknologi" class="flex items-center gap-4 p-3 font-semibold text-[var(--color-text)] dark:text-[var(--color-dark-text)] rounded-lg hover:bg-[var(--color-border)] dark:hover:bg-[var(--color-dark-border)] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 10.5h-2v-2h2v2zm-4-2h2v2h-2v-2zm-4 2h2v-2h-2v2zm10 4h2v2h-2v-2zm-4 2h2v-2h-2v2zm-4 0h2v-2h-2v2zm12-9.5c0-.8-.7-1.5-1.5-1.5H5.5c-.8 0-1.5.7-1.5 1.5v9c0 .8.7 1.5 1.5 1.5h13c.8 0 1.5-.7 1.5-1.5v-9zM20 19H4V8h16v11z"/></svg>
                <span>Teknologi</span>
            </a>
            <a href="/categories/tutorial" class="flex items-center gap-4 p-3 font-semibold text-[var(--color-text)] dark:text-[var(--color-dark-text)] rounded-lg hover:bg-[var(--color-border)] dark:hover:bg-[var(--color-dark-border)] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v12H3V6m15-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/><path fill="none" d="M0 0h24v24H0z"/><path d="m9.41 15.41 4.59-4.59-4.59-4.59L10.83 5l6 6-6 6-1.42-1.41z"/></svg>
                <span>Tutorial</span>
            </a>
        </nav>
        <div class="pt-4 mt-4 border-t border-[var(--color-border)] dark:border-[var(--color-dark-border)] flex justify-between items-center text-[var(--color-text)] dark:text-[var(--color-dark-text)]">
            <span class="flex items-center gap-4 font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 4c.93 0 1.78.26 2.53.71L6.21 13.03A7.94 7.94 0 0 1 4 12c0-4.41 3.59-8 8-8zm0 16c-.93 0-1.78-.26-2.53-.71L17.79 10.97A7.94 7.94 0 0 1 20 12c0 4.41-3.59 8-8 8z"/></svg>
                <span>Ganti Tema</span>
            </span>
            <button id="theme-toggle-mobile" title="Ganti tema" class="p-2 rounded-full text-[var(--color-secondary)] dark:text-[var(--color-dark-secondary)] hover:bg-[var(--color-border)] dark:hover:bg-[var(--color-dark-border)] transition-colors">
            </button>
        </div>
    </div>
</header>

<script>
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', () => {
            // Cek apakah menu sedang terbuka (tidak memiliki class opacity-0)
            const isOpen = !mobileMenu.classList.contains('opacity-0');

            if (isOpen) {
                // Jika terbuka, TUTUP menu
                mobileMenu.classList.add('opacity-0', '-translate-y-4', 'pointer-events-none');
                mobileMenu.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
            } else {
                // Jika tertutup, BUKA menu
                mobileMenu.classList.remove('opacity-0', '-translate-y-4', 'pointer-events-none');
                mobileMenu.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
            }
        });
    }

    const desktopToggle = document.getElementById('theme-toggle-desktop');
    const mobileToggle = document.getElementById('theme-toggle-mobile');

    if (desktopToggle && mobileToggle) {
        mobileToggle.innerHTML = desktopToggle.innerHTML;
        const toggleTheme = () => {
            document.documentElement.classList.toggle('dark');
            const newTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
        };
        desktopToggle.addEventListener('click', toggleTheme);
        mobileToggle.addEventListener('click', toggleTheme);
    }
</script>